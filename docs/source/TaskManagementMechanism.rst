タスク管理機構の概要
===================================

タスク管理機構とはOPERAと連携し、Behavior Treeを使用してユーザから与えられたタスク（施工シナリオ）をもとに建設機械を操作するための仕組みである。
タスク管理機構では、データベースに格納された情報を任意のタイミング読み出してきて、これらの値をもとに動作する。このため、以下のデータを事前にデータベースに格納しておく必要がある。

- **タスクデータ** : 
  
  施工シナリオに沿った建設機械の一連の動作データ
- **静的パラメータデータ** : 
  
  タスク実行開始時に読み出される、タスクデータの一部を保管するデータ
- **動的パラメータデータ** : 
  
  タスク実行中に読み出される、タスクデータの一部を保管するデータ

パラメータデータは、例えばダンプのナビゲーションの目標位置姿勢である。タスクデータでは当初はこのデータが未定の状態となっており、
代わりにデータベース上の値を検索するためのキーが与えられている。このキーをもとにパラメータデータを読み出してきて、
タスクデータを補完することで一連の施工シナリオを作り出す。パラメータデータにはタスク実行開始時にのみ読み出される静的なものと、
タスク実行中に読み出される動的なものの2種類が存在し、前者を静的パラメータデータ、後者を動的パラメータデータと呼ぶ。
以下では、タスク実行に必要となるデータが事前にデータベースに格納されていることを前提として、タスク管理機構における処理の流れを以下に示す。

.. image:: images/TaskManagementMechanism_Architecture.svg
   :alt: システム構造
   :width: 600px
   :align: center  
  
.. raw:: html

   <br><br>

1. ユーザからの実行指令がタスク管理機構へと送られてくると、タスクスケジューラ (Behavior Tree)がデータベースから施工の遂行に必要なタスクデータ
   及び静的パラメータデータを読み出す。実行するタスクを検索するための情報はユーザからの実行指令に含まれる。 (TMS_UR→ TMS_TS → TMS_DB → TMS_TS)
2. タスクスケジューラが読み出した値をもとに、タスクを実行し、操作指令を建設機械へと送る。(TMS_TS → TMS_IF_for_OPERA → TMS_RP → TMS_RC → Mahcinery)
3. 建設機械は送られてきた指令をもとに動作し、建設機械の位置姿勢といった情報や与えられた操作指令の実行状況をタスクスケジューラへと逐次返却する。(Machinery → TMS_RC → TMS_RP → TMS_IF_for OPERA → TMS_TS)

加えて上記の流れでタスク実行がなされている間、以下の流れに従って環境側に配置されたセンサからの情報をデータベースを介してタスクスケジューラへと伝え、タスク実行に反映させる。

1. 建設現場など環境側に配置されたセンサからの情報を収集する。(Sensor → センシングPC)
2. 収集した情報を処理し、メタデータを付与して ROS2-TMS for Construction へと送る。 (センシング PC → TMS_SP)
3. ROS2-TMS for Construction は値を受け取ると、メタデータをもとにデータベース上の該当データを見つけ、受け取ったデータで上書きする。(TMS_SP → TMS_DB)
4. タスクスケジューラはタスクの実行中にデータベース上から値を見つけ、実行中のタスク列に反映させる。(TMS TS → TMS DB → TMS TS)
5. 反映したタスク列に基づき、建設機械へと動作指令を送ったのちにそのフィードバックとして建設機械から状態信号を受け取る (TMS_TS → TMS_IF_for_OPERA → TMS_RP → TMS_RC → Machinery → TMS_RC → TMS_RP →TMS_IF_for_OPERA → TMS_TS)

このように、タスク管理機構においては建設機械自体に取り付けられたセンサと環境側に配置したセンサからの2つの情報をもとに建設機械を操作することが可能となっている。


.. note::

   This project is under active development.
